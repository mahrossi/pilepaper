\documentclass[aps,prb,superscriptaddress,amsmath,amssymb,showpacs,twocolumn]{revtex4}
%\documentstyle{article}
%\usepackage[paperwidth=210mm,paperheight=297mm,centering,hmargin=1.8cm,vmargin=1.8cm]{geometry}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{subfigure}
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
\usepackage{ulem}
\usepackage{caption}
\normalem


\bibliographystyle{apsrev}
\makeatletter
\begin{document}
%opening

\title{An \textit{ad hoc} improvement to ring polymer molecular dynamics}
\author{Mariana Rossi}
\affiliation {Physical and Theoretical Chemistry Laboratory, 
University of Oxford, South Parks Road, Oxford OX1 3QZ, UK}
\author{Michele Ceriotti}
%\email{michele.ceriotti@chem.ox.ac.uk}
\affiliation {EPFL}
\author{David E. Manolopoulos}
\affiliation {Physical and Theoretical Chemistry Laboratory, 
University of Oxford, South Parks Road, Oxford OX1 3QZ, UK}


\newcommand{\avg}[1]{\ensuremath{\left<#1\right>}}
\newcommand{\mc}[1]{{\color{blue}#1}}
\newcommand{\mr}[1]{{\color{Plum}#1}}
%\newcommand{\remove}[1]{{\sout{#1}}}
\newcommand{\remove}[1]{}
\newcommand{\oxford}[1]{{\color{blue} #1}}
\newcommand{\berlin}[1]{{\color{red}#1}}
\newcommand{\Tr}{\ensuremath{\operatorname{Tr}}}
\newcommand{\img}{\ensuremath{\mathrm{i}} }
\newcommand{\diff}{\ensuremath{\mathrm{d}} }
\newcommand{\Cqq}{\ensuremath{\tilde{C}_{qq}(t) }}


\begin{abstract} 
Two of the most successful methods that are available for simulating the quantum dynamics of
condensed phase systems are ring polymer molecular dynamics (RPMD) and centroid molecular dynamics (CMD).
Despiste their conceptual differences, practical implementations of these methods differ in just two aspects:
the choice of the Parrinello-Rahman mass matrix and whether or not a thermostat is applied to the internal 
modes of the ring polymer during the dynamics. 
Here we explore a method which is in a sense `half-way' 
between the two approximations: we keep the path integral bead masses equal to the physical particle
masses but attach a path integral Langevin equation (PILE) thermostat to the internal modes of the
ring polymer. The justification for this is that the inclusion of an internal mode thermostat does
not affect any of the wholesome features of RPMD: because of the choice of bead masses, the 
resulting method is still optimum in the short-time limit, and the transition state approximation
to its reaction rate theory remains closely related to the semiclassical instanton approximation
in the deep quantum tunneling regime. In effect, there is a continuous family of methods with
these properties, parameterised by the coupling strength of the PILE thermostat,
\mc{that equally well preserve the short-time limit of RPMD, which depends on the choice of the mass
matrix but is not sensitive to thermostatting of the internal modes. }
Here we explore numerically how the approximation to quantum dynamics depends on this coupling strength, % MR: maybe not?
with a particular emphasis on vibrational spectroscopy.
\mc{We find that a broad range of values around the critical damping chosen
for the original PILE thermostat give very similar results, that give a reasonable
albeit arguably \emph{ad hoc} approximation to quantum effects, while being 
immune to both the resonance problem of RPMD and the curvature and time step problems of CMD.
\sout{We find that the critical damping chosen
for the original PILE thermostat is close to optimum, % MR: maybe we also don't need to say this.
and that the resulting dynamical approximation
is immune to both the resonance problem of RPMD and the curvature problem of CMD.}
}
\end{abstract}

\maketitle

The quantum nature of light nuclei has a very significant impact on the behaviour
of molecules and materials, not only at cryogenic temperatures, but also at room 
temperature and above. 
Well-established techniques exist to perform atomistic simulations that accurately
and rigorously include nuclear quantum effects (NQEs) on static, time-independent
configurational and thermodynamic
properties\cite{feyn-hibb65book,chan-woly81jcp,parr-rahm84jcp,cepe95rmp},
and efforts are concentrated on making them less demanding, with some success \cite{ceri-mano12prl,  SUZUKI-CHIN/TUCKERMAN} 

For what concerns dynamical properties, however, the situation is much less clear.
Exact techniques are extremely complex, and impractical for anything but the simpler
molecules~\cite{????DAVID????}. Approximate techniques are restricted to either quasi-harmonic
perturbative expansions\cite{????} or one of few approximate, semi-classical 
techniques, most notably the linearized semi-classical initial value representation (LSC-IVR),
centroid molecular dynamics (CMD)~\cite{cao-voth93jcp,cao-voth94jcp}, and ring-polymer 
molecular dynamics (RPMD).
LSC-IVR can be derived rigorously starting from quantum mechanical expressions, but 
the approximations that are practically affordable are affected by severe
zero-point energy leakage, which makes it very hard to collect satisfactory statistics
and casts shadows on the applicability to long-time properties of anharmonic systems.
CMD and RPMD both can be regarded as real-time versions of imaginary-time path integrals,
CMD being essentially classical molecular dynamics on the centroid potential of mean force,
RPMD being classical molecular dynamics based on the ring polymer Hamiltonian. 
Both are to an extent arbitrary, \emph{ad hoc} approximations, even though recent 
efforts have put them on somehow more robust grounds \cite{rich-alth09jcp,hele-alth13jcp,jangvoth99jpc, jangvoth99jpc2, MORE?}.
They are only exact for linear operators in the harmonic limit\cite{habe+13arpc, jangvoth99jpc2}, and 
both are known to exhibit artefacts that are most evident when computing vibrational
spectra of molecules~\cite{witt+09jcp, ivanov+10jpc, habe+08jcp}, that are related to the so-called curvature problem for CMD
(that we will interpret as a consequence of adiabatic separation between the centroid
and the internal modes of the ring polymer) and resonance between physical modes
of the system and internal modes of the ring polymer for RPMD.

Here we will discuss the effect of thermostatting the internal modes of the ring
polymer while using the physical ring polymer mass matrix, thereby obtaining a method
that can be regarded as a ``hybrid'' of RPMD and CMD. We will show that both 
the short-time limit accuracy of RPMD and the analogy between RPMD and the instanton
in the study of rates are not affected by the use of stochastic thermostats for the
internal modes of the  ring polymer. This means that there is a whole family of methods,
differing by the details of the thermostatting, that are not more a \emph{ad hoc}
than RPMD, and offer a way to improve upon the existing approximations. 
While we cannot at this stage suggest a way to exploit this additional
freedom to obtain a more rigorous method for quantum dynamics, we show that
for a broad range of thermostat parameters, this stochastic term
cures the resonance problem of RPMD without triggering the curvature
problem. Furthermore, this method can be ued with much larger time steps
than CMD, as it uses the RPMD mass matrix and does not rely on adiabatic separation.

The Langevin RPMD approach we introduce (which we refer to as \textit{PILE}) is a practical solution to explore
the role of NQEs on dynamical properties, even though we cannot claim that there is 
a universal choice of the damping that gives a rigorously better approximation 
to quantum dynamics. It is quite possible that by exploring the additional 
degrees of freedom that are associated with stochastic dynamics of the 
internal modes of the ring polymer future research may eventually fulfill this 
arduous goal.

\section{ALL SECTIONS FROM DAVID \label{sec:invariance}}


%\section{The resonance problem}
%
%\mc{Do we want to put the analytical results for the off-diagonal coupled oscillators here?}
%\mr{If we can show just a picture about how PILE changes the spectrum, it would be nice.}
%
%We here define the ring polymer effective Hamiltonian, in the bead representation, as
%
%\begin{eqnarray}
%H_n & = & \underbrace{\sum_i^N \sum_j^n \left[\frac{\vert {\bf p}_i^{(j)} \vert^2}{2m^{\prime}_i} + \frac{1}{2}m_i\omega_n^2 \vert {\bf q}_i^{(j)} - {\bf q}_i^{(j-1)} \vert^2 \right]}_{H_0} \nonumber \\
%& & + \sum_j V({\bf q}_1^{(j)}, ..., {\bf q}_N^{(j)}), 
%\label{eq:pimd-hamiltonian}
%\end{eqnarray}
%
%\noindent where $H_0$ is the free ring polymer Hamiltonian, $i$ runs through the $N$ particles of the physical system, $j$ runs through the $n$ path integral replicas,
%${\bf p}_i^{(j)}$ and ${\bf q}_i^{(j)}$ are the momenta and positions associated with particle $i$, replica $j$, respectively, $V$ is the physical interacting potential, and $\omega_n=nk_bT/\hbar$. We note that while $m_i$ should correspond to the physical masses of the system, there is no 
%$a priori$ requirement for the choices of $m^{\prime}_i$ in the standard PIMD formulation, since this term is just added to the Halmiltonian
%to allow the evaluation of the dynamics. Finally, ${\bf q}_i^{(n+1)} = {\bf q}_i^{(1)}$, which closes the ring polymer. 
%
%As explained in detail in Ref. \cite{ceri+10jcp}, it is possible to perform a normal mode transformation on the Hamiltonian above, such that
%the free ring polymer Hamiltonian $H_0$ can be written as
%
%\begin{eqnarray}
%H_0 & = &  \frac{1}{2}{\bf \tilde{P}}^T {\bf M}^{-1} {\bf \tilde{P}} + \sum_i^N \sum_{k=0}^{n-1} \left[ \frac{1}{2}m_i\omega_k^2 ({\bf \tilde{q}}_i^{(k)})^2 \right],
%\label{eq:h0-normalmode}
%\end{eqnarray}
%
%\noindent where $\tilde{P}$ is an array containing all normal mode transformed momenta ${\bf \tilde{p}}_i^{(k)}$, ${\bf \tilde{q}}_i^{(k)}$ are the normal mode  transformed coordinates, and $\omega_k = 2 \omega_n \sin(k\pi/n)$. In RPMD, the mass matrix ${\bf M}$ simply a diagonal matrix containing all the physical masses $m_i$ of the system, and the time evolution of position and momenta are carried out without any thermostat attached to them. In the normal mode representation, $k$=0 is the mode connected to the centroid and $k>0$ represent the internal modes of the ring polymer. It is already worth pointing out that $\omega_1 \approx 2\pi/(\beta\hbar)$ for the free ring polymer lies around 1300 cm$^{-1}$ at 300K and around 435 cm$^{-1}$ at 100K (a temperature that will be important later on in this paper).
%
%As pointed out in Refs. \cite{habe+08jcp, witt+09jcp, ceri+11jcp}, if one applies the RPMD formalism to a simple potential corresponding to a chain of uncoupled harmonic oscillators $V({\bf q})=\sum_i m_i\omega_i^2q_i^2/2$,
%it is straightforward to show that the frequencies of vibration of ring polymer will be given by \mr{check!}
%
%\begin{eqnarray}
%\omega_k^{i}=\sqrt{\omega^2_i + 4 \omega_n^2 \sin^2(k\pi/n)},
%\label{eq:harm-freq-rpmd}
%\end{eqnarray}
%
%\noindent such that the centroid vibrates at the frequencies of the physical system and the other internal modes vibrate at higher frequencies. Clearly, in any real system, the potential will not be exactly harmonic, and the expression in Eq. \ref{eq:harm-freq-rpmd} will be just an approximation for the internal frequencies of the ring polymer. Nevertheless, Eq. \ref{eq:harm-freq-rpmd} already shows clearly the origin of the so-called ``resonance-problem" of RPMD, thoroughly discussed in Refs. \cite{habe+08jcp, witt+09jcp}: For systems with vibrational frequencies $\omega_i$ spanning from small to large wavenumbers, there will be an $\omega_k$ for, e.g. a small $\omega_i$ that will have a very similar frequency to another larger $\omega_i$, so that they will resonate. The lower the temperature, the more severely will these spurious frequencies contaminate the true spectrum, so that for most real-life applications, RPMD cannot be used for the evaluation of vibrational spectra.
%
%%\mr{Show stupid plots of eq. \ref{eq:harm-freq-rpmd} for 300K and 100K with varying $\omega$ that I added to the "extra" folder?}
%
%\section{The curvature problem}
%
%The resonance problem is characteristic to RPMD. CMD avoids contamination of the 
%spectrum by internal modes of the ring polymer by (partial) adiabatic decoupling,
%that ensures that there is no overlap between the range of frequencies of the 
%centroid vibration and that of the non-zero frequency internal modes.
%On the contrary, the so-called curvature problem is characteristic of CMD, 
%and consists in a red shift of stretching modes of groups of atoms that also 
%possess librations or wagging modes, that is accompanied by a broadening of 
%the peak and that becomes more and more pronounced as the temperature decreases. 
%
%As discussed in Ref.~\cite{witt+09jcp}, the curvature problem can be understood
%as arising because the centroid moves on an effective potential, in which 
%the stretching mode is averaged over a soft, strongly non-linear 
%motion of the molecule. In fact, the curvature problem is most severe for a freely-rotating
%bond, and becomes less dramatic when the spread of the ring polymer orthogonal to
%the bond is restricted by angular restraints~\cite{witt+09jcp}, or by the presence 
%of weak interactions with other molecules~\cite{paesani-voth10jcp}.
%
%Note that one could regard this effect as a spurious coupling between
%the physical, centroid component of the stretching mode and the 
%(adiabatically decoupled) internal vibrations of the ring polymer
%in the perpendicular, free-rotation motion. There is in this regards
%an interesting connection with the resonance problem of RPMD: at 
%least in the case of the simple models discussed in Ref.~\cite{witt+09jcp}, 
%resonances happen when the \emph{free ring-polymer} internal mode frequencies 
%match the frequency of the stretching, indicating that the resonance problem
%is also exacerbated by the presence of soft, strongly non-linear wagging modes.
%
%Since the curvature problem is caused by the centroid moving on a mean 
%potential surface, averaged over the internal modes, one could 
%wonder whether thermostatting the internal modes of the ring polymer
%as we advocate here would be enough to cause a similar effect, even 
%without changing the mass matrix.
%
%
%\section{The ``PILE'' method}
%
%Since it was shown in Section \ref{sec:invariance} that the application of the PILE
%thermostat on the internal modes of the ring polymer does 
%not disturb the short time limit of RPMD \mr{(still to be shown)}, we here apply this
%technique in order to obtain vibrational spectra free of the resonances that 
%affect RPMD. We call this method \textit{PILE} in the following.
%
%As explained in Ref. \cite{ceri+10jcp}, applying the PILE thermostat amounts to
%the following equations of motion in the normal mode representation,
%
%\begin{eqnarray}
%\frac{d}{dt}{\tilde{\bf q}}_i^{(k)} & = & {\tilde{\bf p}}_i^{(k)}/m_i, \nonumber \\
%\frac{d}{dt}{\tilde{\bf p}}_i^{(k)} & = & -m_i\omega_k^2{\tilde{\bf q}}_i^{(k)} - \gamma^{(k)} {\tilde{\bf p}}_i^{(k)} + \sqrt{\frac{2m_i\gamma^{(k)}}{\beta_n}} {\boldsymbol\xi}_i^{(k)}(t),
%\end{eqnarray}
%
%\noindent where ${\boldsymbol\xi}_i^{(k)}$ is a vector of Gaussian-distributed, uncorrelated random noise. 
%The $\gamma^{(k)}$ friction coefficients that yield critical damping are the ones that minimize
%the correlation time $\tau_H$ for the Hamiltonian of the harmonic oscillator, subject to the Langevin equations of
%motion above. As explained in Ref. \cite{ceri+10jcp}, the analytical result is,
%
%\begin{equation}
%\tau_H=\frac{1}{\gamma^{(k)}} + \frac{\gamma^{(k)}}{4\omega_k^2},
%\end{equation} 
%
%\noindent so that the optimum value is $\gamma^{(k)}_c=2\omega_k$. The difference of the treatment here,
%as compared to the one in Ref. \cite{ceri+10jcp} is that we do set $\gamma^0=0$, i.e., the centroid mode
%is not thermostatted and follows Hamiltonian dynamics. 
%
%As shown in Section \ref{sec:invariance}, we do not find a criterion to fix the $\gamma^{(k)}$ parameters.
%While choosing them to yield critical damping seems a sensible choice, we also investigate the effect of
%changing these parameters to yield underdamped and overdamped regimes of the Langevin equation in the
%following sections.
%
%\section{The quartic oscillator}
%
%
%In this section, we show the results we obtain when applying RPMD, CMD, and the \textit{PILE} method 
%to the one dimensional anharmonic quartic potential $V(q)=q^4/4$, already explored previously in the literature (e.g. Refs. \cite{crai-mano04jcp, jangvoth99jpc}).
%We here consider $\hbar=1$, $m=1$, and $\beta=10$, in natural units. For the RPMD and \textit{PILE} simulations, we used 64 beads, and a time step $\Delta t = 0.01$ for the integrator, which ensures convergence and accuracy of all relevant quantities in the simulation. For CMD, we used a time step of 0.002 natural units.
%\mr{[comment: change PILE for \textit{PILE} in the following?]}
%
%\begin{figure}[htbp]
%\begin{center}
%\includegraphics[width=0.48\textwidth]{figures/vv_autocorr_quartic}
%\end{center}
%\caption{Velocity autocorrelation function for the quartic one-dimensional potential $V(q)=q^4/4$. The dotted line corresponds to the exact result. All units are atomic units, $m$=1, and $\beta$=10.}
%\label{fig:autocorr-quartic}
%\end{figure}
%
%In Figure \ref{fig:autocorr-quartic}, we show the velocity autocorrelation functions calculated from 10000 trajectories of 200 time units. 
%All correlation functions were obtained after thermalization runs with a simple Andersen thermostat. We plot the correlation function of RPMD, CMD,
%PILE ($\gamma^{(k)}=\gamma^{(k)}_c$), underdamped PILE ($\gamma^{(k)}=0.1\gamma^{(k)}_c$), and overdamped PILE ($\gamma^{(k)}=10\gamma^{(k)}_c$). The dotted lines correspond to the
%exact result, in which the autocorrelation function does not decay. All methods predict an artificial decorrelation of the autocorellation function, with CMD being the closest to the exact result and PILE (critical damping), being the second best. The fact that critically damped PILE gives a better result
%than RPMD and than its underdamped and overdamped variations is not expected to be always true - it just happens to be the
%case for this potential. In any case, what we do expect, given the mathematical derivations above, is that PILE still gives a good approximation
%to the real quantum result in a wide range of systems.
%
%\begin{figure}[htbp]
%\begin{center}
%\includegraphics[width=0.38\textwidth]{figures/vv_fourier_quartic.pdf}
%\end{center}
%\caption{Fourier transform of the velocity autocorrelation function for the quartic one-dimensional potential $V(q)=q^4/4$. The dotted line corresponds to the expected exact result for the position of the peak. All units are atomic units, $m$=1, and $\beta$=10.}
%\label{fig:spec-quartic}
%\end{figure}
%
%
%We note that for this 1D potential there will be no resonance problem in RPMD in the main peak, since the ring-polymer frequencies are always shifted to higher frequencies with respect to the first physical one ($\approx$ Eq. \ref{eq:harm-freq-rpmd}), and there is only one frequencies. We see this effect in the overtones but since they have very low intensity, they do not affect the spectrum. Also, there is no curvature problem, simply because it is a 1D potential. In Figure 
%\ref{fig:spec-quartic} the corresponding Fourier transforms of the autocorrelation functions shown in Fig. \ref{fig:autocorr-quartic} are shown, which just confirm the considerations above. CMD and critically damped PILE produce the narrowest peaks, with the exact result being a $\delta$-function centered at the position of the dotted line. 

\begin{figure}[htbp]
\centering
\includegraphics[width=0.5\textwidth]{figures/champagne.pdf}
\caption{Schematic representation of the source of the resonance and curvature problems for a ring polymer 
moving on top of a champagne-bottle potential (represented by the color scale, where white represents low energy and blue 
and orange higher energies). a) Internal motion of the ring polymer in the angular direction can couple with motion 
of the centroid in the radial direction. b) When internal motion of the ring polymer is decoupled from the centroid, 
the ring polymer can relax the energy by contracting or relaxing in the angular direction, effectively softening the
potential of mean force in the radial direction. }
\label{fig:champagne}
\end{figure}

\section{Solving the resonance and curvature problems}

In the previous section we have demonstrated that adding a stochastic thermostat to the internal degrees of freedom
of a ring polymer without changing the mass matrix preserves all of the wholesome properties of RPMD, and only reduces
the short-time limit accuracy by one order in time. 
Here we will demonstrate that in several model and realistic problems a PILE thermostat with critical damping 
is immune to both the resonance problem of RPMD and the curvature and time step problems of CMD.


%In Ref.~\cite{witt+09jcp} it was shown that both RPMD and CMD 
%exhibits clearly unphysical artefacts when it comes to modeling infra-red spectroscopy and vibrational dynamics. 
%Namely, vibrational spectra obtained by RPMD are contaminated by resonances between the physical vibrational modes
%of the system and the internal modes of the ring polymer, whyle CMD spectra are affected by a curvature problem that
%causes high frequency peaks to broaden and shift to lower frequencies with decreasing temperature. 

%Both of these problems are two faces of the same coin, and can be traced to the interplay of 
%high-frequency stretching modes and near-zero frequency rotations or wagging modes of the bond. 
% This can be understood by considering a ring polymer in a ``champagne bottle'' potential, as in 
%Figure~\ref{fig:champagne}a. Internal vibrations of the ring polymer along the angular direction 
%engender a net motion of the centroid in the radial direction, which is amplified
%when the two motions are in resonance. In the presence of a harmonic potential of frequency $\omega$, 
%the ring polymer frequencies are shifted to $\sqrt{\omega^2 + \tilde{\omega}^2_k}$, so in a truly 
%one-dimensional system there can never be a resonance. The fact that resonances involve an interplay 
%of different physical directions is apparent from the fact that they are observed when \emph{free ring polymer} 
%frequencies overlap with the range of frequencies corresponding to physical vibrational frequencies.

%The adiabatic decoupling that underlies CMD can shift the internal vibrations outside of the range of 
%physical frequencies, but does not eliminate the fact that internal angular vibrations are geometrically 
%coupled with the radial centroid motion. 
%As shown in Figure~\ref{fig:champagne}b, a radial displacement of the ring polymer that would correspond to a high 
%curvature of the potential can also be produced by an internal contraction in the soft angular
%direction. This results in an effective softening of the radial potential of mean force, which is the essence
%of the curvature problem as discussed in Ref.~\cite{witt+09jcp}.


\subsection{Model molecules: OH and CH$_4$}

We start by considering two model molecules that have been studied in Ref. \cite{witt+09jcp},
namely the OH and the CH$_4$ molecules with a harmonic interatomic potential given by

\begin{equation}
\phi=\sum_{bonds} \frac{k_b}{2} (r-r_{eq})^2 + \sum_{angles} \frac{k_a}{2}(\theta - \theta_{eq})^2,
\label{eq:model}
\end{equation}

\noindent where we use all the same values for $k_b$, $k_a$, $r_{eq}$, and $\theta_{eq}$ that were used in Ref. \cite{witt+09jcp}.
%These model molecules are especially interesting because they are known cases where
%both the curvature and the resonance problems have been well studied by Witt and coworkers\cite{witt+09jcp}.
%As in Ref. \cite{witt+09jcp}, we chose $k_b=0.49536$ Ha/bohr$^2$ and $r_{eq}=1.0$\AA~ for the OH molecule,
%and  $k_b=0.30345$ Ha/bohr$^2$, $k_a=3.1068\times10^{-5}$ Ha/deg$^2$, $r_{eq}=1.09$\AA, and $\theta_{eq}=107.8$deg for
%the CH$_4$ molecule. 

\begin{figure}[htbp]
\centering
\includegraphics[width=0.5\textwidth]{figures/comparison_oh_factors.pdf}
\caption{Dipole absorption cross section for the OH model molecule with an interatomic potential given by Eq. \ref{eq:model}: (a) and (b) CMD and PILE methods at 100, 200, and 300K ; (c)  and (d) RPMD and PILE methods at 109, 450, and 436 K. The dotted grey line corresponds to the classical vibrational frequency predicted for this model $\omega_\text{OH}=$3715.6cm$^{-1}$.}
\label{fig:oh-rpmd-cmd-pile}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[width=0.5\textwidth]{figures/comparison_ch4_factors.pdf}
\caption{Dipole absorption cross section for the CH$_4$ model molecule with an interatomic potential given by Eq. \ref{eq:model}: (a) and (b) CMD and PILE methods at 100, 200, and 300K; (c) and (d) RPMD and PILE methods at 136, 273, and 450 K.}
\label{fig:ch4-rpmd-cmd-pile}
\end{figure}

For each molecule we calculate the dipole absorption cross section $n(\omega)\alpha(\omega)\propto \omega^2  \tilde{I}(\omega)$, 
where $\tilde{I}(\omega)$ is the Fourier transform of the Kubo-transformed autocorrelation function of the molecular dipole 
moment~\cite{habe+08jcp}. CMD, RPMD, and PILE all yield an approximation to this autocorrelation function. 
The resulting spectra are shown in Figure~\ref{fig:oh-rpmd-cmd-pile} for the model OH 
and in Figure~\ref{fig:ch4-rpmd-cmd-pile} for CH$_4$. 
For the sake of comparison, simulations were performed removing translations and 
rotations, at the same temperatures and with the same number of beads as in Ref. \cite{witt+09jcp}.

In both figures we show in panels (a) and (c) the CMD and RPMD 
spectra, which are fully consistent with the results reported 
in Refs. \cite{witt+09jcp, ivanov+10jpc}.
The curvature problem of CMD is apparent for both molecules.
The high-frequency stretching peaks shift (quite dramatically)
to lower frequencies, and broaden substantially with 
decreasing temperatures.
The shift is more accentuated for the OH molecule than for the
CH$_4$ molecule, since the presence of an angular term in the potential 
for methane reduces the spread of the ring polymer in the
direction orthogonal to the stretch, thereby limiting the 
softening of the effective centroid potential.
For RPMD, one clearly sees that peaks in the spectrum are
split by resonances at temperatures where the free ring polymer frequencies
coincide with the physical frequencies (109K and 436K for
OH and 136K and 273K for CH$_4$). The resonance
problem is just as accentuated for both molecules, since its origin is 
related to the coupling between \emph{small vibrations} of internal and centroid
modes along different molecular axes.


In panels (b) and (d) we show the critical-damping PILE results for both 
molecules at the same temperatures used for CMD and RPMD. 
In all cases the resonant peaks disappear and the curvature problem is not present. 
This shows that the curvature problem does indeed depend on the choice
of the mass matrix used in CMD, 
rather than on the thermostatting of the internal modes.
As we will discuss more in detail in the next subsection, the PILE
spectrum gets broader as the temperature is lowered.
This is a consequence of the fact that internal modes oscillations
are damped by the Langevin term but not eliminated. They do not
show up as sharp resonances, but contribute as an indirect 
damping of physical oscillations that becomes more pronounced as 
the temperature lowers and the spacing between internal frequencies 
decreases.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.4\textwidth]{figures/oh_rpmdvspiledampings_109K.pdf}
\caption{Dipole absorption cross section for the OH 
model molecule at 109K. The various plots show the RPMD spectrum compared to the 
PILE methods with different $\gamma^{(k)}$ parameters.}
\label{fig:oh-rpmd-pile-dampings}
\end{figure}

Since there is no stringent requirement to use a critical damping for the 
$\gamma^{(k)}$ parameters in Eq.(???), we have investigated the sensitivity of 
results to the choice of damping. Figure \ref{fig:oh-rpmd-pile-dampings} 
shows the PILE IR spectrum of the OH molecule at 109K calculated with different
$\gamma^{(k)}$ parameters, both in the underdamped and overdamped regimes. 
The changes observed are not substantial: Going as high as ten times the critical 
damping (Fig. \ref{fig:oh-rpmd-pile-dampings}(e)), or as low
as one tenth of it (Fig. \ref{fig:oh-rpmd-pile-dampings}(a)), does not change 
the peak position by more than 3\%. 


\subsection{Realistic OH molecule}


We consider now the OH molecule 
with an anharmonic interatomic potential given by
%
\begin{equation}
\phi = D_{e} \left[ 1-e^{-\alpha(r-r_{e})}\right]^2 
\label{eq:morse}
\end{equation}
%
 where $D_{e} = \omega_e^2/4\omega_e\chi_e$, $\alpha=\sqrt{2\mu_{OH}\omega_e\chi_e}$. The 
parameters $\omega_e$=3737.76 cm$^{-1}$, $\omega_e \chi_e$=84.881 cm$^{-1}$, and $r_{e}$ = 0.96966 \AA\, 
were obtained from the parameters measured for the real OH molecule, as reported in Ref. \cite{HerzbergBook}.
Since the energy levels for this potential can be computed exactly, this is a good test case for 
separating the curvature problem of CMD from the real anharmonic shift of the peaks, 
and also to study how the PILE method performs on a more realistic potential.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.5\textwidth]{figures/comparison_ohanharm_factors.pdf}
\caption{Dipole absorption cross section for the realistic OH molecule with an interatomic 
potential given by Eq. \ref{eq:morse}: (a) and (b) CMD and PILE methods at 100, 200, 
and 300K ; (c)  and (d) RPMD and PILE methods at 109, 450, and 436 K. The dotted grey line corresponds to the 
anharmonic (exact) vibrational frequency predicted for this model $\omega_\text{morse}=$3568 cm$^{-1}$.}
\label{fig:ohreal-rpmd-cmd-pile}
\end{figure}

Figure \ref{fig:ohreal-rpmd-cmd-pile} is analogous to Figure \ref{fig:oh-rpmd-cmd-pile}, 
but now with the anharmonic potential of Eq. \ref{eq:morse}. 
For the CMD and RPMD methods (panels (a) and (c)) we
see very similar curvature and resonance problems, as observed in the 
previous section for the harmonic potential. 
It is worth pointing out that even at 300K and for a realistic anharmonic potential, 
the position of the peak of the CMD method is considerably red-shifted with respect 
to the exact anharmonic result (dotted line in Fig. \ref{fig:ohreal-rpmd-cmd-pile}). 

\begin{figure}[htbp]
\centering
\includegraphics[width=0.35\textwidth]{figures/ohreal_positionbroad.pdf}
\caption{Full width at half maximum FWHM (top) and peak position (bottom) with respect 
to temperature for the spectra shown in Fig. \ref{fig:ohreal-rpmd-cmd-pile}, 
plus data for spectra at 1000K for all methods. For the RPMD method we only 
show the data for the non resonant case at 350K and at 1000K. The dotted line 
in the bottom panel shows the exact position predicted for the peak at 3568 cm$^{-1}$.}
\label{fig:ohreal-position-broad}
\end{figure}

The PILE method, shown in panels (b) and (d) of Fig. \ref{fig:ohreal-rpmd-cmd-pile}, heals both the curvature 
and resonance problems, and yield peaks that are not only less than 30 cm$^{-1}$ away from the exact answer, but 
also do not shift with changing temperature. The PILE peaks are broader in this potential than
in the case of the harmonic OH. In order to better quantify the temperature dependence of the position 
and broadening of the peak, we have fitted a Lorentzian curve to the peaks shown in Fig. 
\ref{fig:ohreal-rpmd-cmd-pile}. 
In Fig. \ref{fig:ohreal-position-broad} we plot the peak position and the full 
width at half maximum (FWHM) as a function of temperature,
also including data from classical simulations.
The shape of the peaks proved to be almost perfectly Lorentzian in all cases,
except for the simulations at 1000K, in which the peaks were noticeably asymmetric.
From the top panel of Fig. \ref{fig:ohreal-position-broad} it becomes evident that 
in the PILE method the broadening of the peaks increases slightly with the lowering 
of the temperature, but not nearly as much as for the CMD method. 
The peak position, shown in the bottom panel, is stable in the PILE method, contrary to
what is observed for CMD. The classical simulations produce a peak
with only FWHM=11cm$^{-1}$ at 100K, but the width increases with temperature.
The peak position of the classical simulation is more than 100 cm$^{-1}$
blue-shifted with respect to the exact result.
All the methods converge to the classical limit as the temperature 
increases. Since the a quantum of vibration at 3500 cm$^{-1}$
corresponds roughly to a temperature of 2500K, even at 1000K one
can observe significant differences.

%Even if the width of the peak decreases with increasing temperature, it is also clear that 
%none of these methods will approach zero width at high temperatures, which should be the 
%correct quantum result ($\delta$-function) at any temperature.

\subsection{The Zundel cation}

\begin{figure*}[htbp]
\centering
\subfigure[300K]{
\includegraphics[width=0.25\textwidth]{figures/oh-stretch-300K.pdf}
}
\subfigure[100K]{
\includegraphics[width=0.435\textwidth]{figures/zundel_lowfreq_100K.pdf}
}
\caption{
(a) Top panel: experimental IRMPD of H$_5$O$_2^+$ for the OH-stretch region at 300K from Ref. \cite{YehLee1989}. The other panels show the IR absorption spectrum of H$_5$O$_2^+$ obtained from the Fourier transform of the dipole autocorrelation, as obtained from simulations at 300K using the CCSD(T) parameterised potential and dipole surfaces of Ref. \cite{HuangBraamsBowman2005}. From top to bottom:
 molecular dynamics with classical nuclei, RPMD, PA-CMD, and PILE with critical damping on internal ring-polymer modes, as indicated by the legend. (b) Top panel: experimental IRMPD of H$_5$O$_2^+$ for the 800-2000$cm^{-1}$ at 100K from Ref. \cite{AsmisScience2003}. The other panels are the same as in (a), but at 100 K.}
\label{fig:zundel-highf-lowf}
\end{figure*}


%\begin{figure}[htbp]
%\centering\includegraphics[width=0.48\textwidth]{figures/zundel_lowfreq_100K.pdf}
%\caption{Top panel: experimental IRMPD of H$_5$O$_2^+$ for the 800-2000$cm^{-1}$ at 100K from Ref. \cite{AsmisScience2003}.
%The other panels show the IR absorption spectrum of H$_5$O$_2^+$ obtained from the Fourier transform of 
%the dipole autocorrelation, as obtained from simulations at 100K using the CCSD(T) parameterised potential 
%and dipole surfaces of Ref. \cite{HuangBraamsBowman2005}. From top to bottom:
% molecular dynamics with classical nuclei, RPMD, PA-CMD, and PILE with critical damping on internal ring-polymer modes,
%as indicated by the legend.}
%\label{fig:zundel-lowf}
%\end{figure}

As a final example of the application of a stochastic term to remove unphysical resonances 
from RPMD spectra, let us consider a more complex case. The Zundel cation H$_5$O$_2^+$ 
is an ideal benchmark system for quantum dynamics methods, having been 
extensively studied in the literature~\cite{Schatteburg2008}, from both a theoretical
\cite{AgostiniCiccotti2011, ParkKim2007, VenerSauer2001, SauerDoebler2005, ChengKrause1997, VendrellMeyer2007, 
BaerMarxMathias2010, KaledinBowmanJordan2009, HuangBraamsBowman2005} 
and experimental~\cite{YehLee1989, GuascoJohnson2011, AsmisScience2003, HammerBowmanCarter2005, FridgenMaitre2004}
points of view. The Zundel cation is also convenient because of the availability of a 
potential energy and dipole surfaces parametrized against CCSD(T) data that was 
published by Huang, Braams and Bowman~\cite{HuangBraamsBowman2005},
which is at the same time very accurate and inexpensive to evaluate. 

Furthermore, H$_5$O$_2^+$ exhibits profoundly quantum mechanical behaviour
that one cannot expect to reproduce with the techniques that we present here
since they all lack quantum phase information. 
At low temperatures the shared proton region contains a doublet feature 
that has attracted a lot of attention~\cite{GuascoJohnson2011, HammerBowmanCarter2005}.
This spectral feature has been interpreted as a Fermi resonance
involving a fourth-order coupling between the proton transfer mode,
the O-O stretching mode, and the H-O-H wagging mode \cite{VendrellMeyer2007, Schatteburg2008}. 
Therefore, it can only be captured by high levels of theory that include 
anharmonic effects and a fully quantum mechanical treatment
of nuclear dynamics, such as the multi-configurational time-dependent Hartree (MCTDH) method at
0K \cite{VendrellMeyer2007}.

With this caveat in mind, let us first consider the frequency range corresponding 
to the OH stretch (Figure~\ref{fig:zundel-highf-lowf}(a)). We performed 200 6ps trajectories
at 300K, using 16 beads and without removing rotations. 
Experiments performed at 300K~\cite{YehLee1989} show two distinct peaks at about 
3600 and 3700 cm$^{-1}$. Similarly to the case of the anharmonic OH discussed 
in the previous subsection, the classical spectrum is blue shifted by almost 
150~cm$^{-1}$. The RPMD spectrum is closer to experiment, but shows multiple peaks and a broad tail
towards lower frequencies. 
In a multi-dimensional problem such as this, resonances may be due to 
internal modes corresponding to non-zero frequency molecular vibrations, which makes it hard
to assess whether and how the spectrum is contaminated by spurious oscillations. 
CMD is red shifted with respect to experiment, and does not show recognizable separate peaks.
Given the high accuracy of the potential energy surface, we can attribute the red shift to the
curvature problem -- and in fact the shift is exacerbated if the temperature is further reduced. 
As pointed out in previous work~\cite{ivanov+10jpc}, in a more complex case in which one could not
use a potential energy surface of such exquisite quality, and in the absence of very clean 
reference experiments, it would be impossible to determine whether the shift relative to the classical
simulation is due to genuine quantum anharmonic effects or to the artefacts inherent in the methodology.
Finally, the critical-damping PILE spectrum shows neither resonances, nor curvature-related red shift. 
The position of the stretching peak  is in better agreement with experiment, even though the excessive 
broadening that was also observed for the harmonic and anharmonic
OH washes out the doublet structure and yields a single peak centered at about 3650 cm$^{-1}$.

We then performed simulations 200 6ps trajectories at 100K using 64 beads 
to compare RPMD, CMD and PILE with experiments measuring the intermediate frequency 
region of the spectrum~\cite{AsmisScience2003} (Figure~\ref{fig:zundel-highf-lowf}(b)). 
All semi-classical approaches generate very broad peaks, and RPMD 
displays multiple peaks in the bending region that can probably be attributed to resonances.
Interestingly, the bending peak for CMD is red-shifted relative to experiment, suggesting 
that at such low temperatures, unphysical effects due to adiabatic decoupling can also manifest themselves 
for lower frequency modes than the OH stretching vibrations. The OH-bending peak at
around 1700 cm$^{-1}$ from the critical-damping
PILE simulations is closest to the experiment and shows no signs of resonances.
As discussed above, none of the approximate methods investigated here can reproduce the
doublet peak at around 1000 cm$^{-1}$, which is shown in the experimental
spectrum of Fig. \ref{fig:zundel-highf-lowf}(b).
This is a reminder that no semi-classical quantum dynamics method can be expected to be capable
of capturing subtle, coherent quantum effects. Methods like CMD, RPMD and its PILE variant 
can only be expected to capture zero-point energy related anharmonic shifts of the
peak position.

% this belongs to conclusions, so we leave it to David
%One has to keep in mind that semi-classical quantum dynamics methods cannot fully account 
%for quantum coherence, and can only provide a qualitative indication of whether quantum 
%effects introduce significant changes to vibrational spectra. Given the 
%prohibitive cost of more sophisticated and accurate methods, however, 
%semi-classical approaches are currently the only viable approach to treat 
%nuclear quantum dynamics in complex systems such as those encountered in the condensed phase.
%The approach we have presented here cures the most evident artefacts of both CMD and RPMD
%by combining features of both.


\section{Conclusions}








\bibliography{biblio}
\end{document}
